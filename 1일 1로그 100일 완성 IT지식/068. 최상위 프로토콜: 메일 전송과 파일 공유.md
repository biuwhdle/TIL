## 1일 1로그 100일 완성 IT지식

3부 통신 - 068 최상위 프로토콜: 메일 전송과 파일 공유

#### 프로토콜

- TCP: 두 컴퓨터 간에 데이터를 주고받는 신뢰성 있는 양방향 스트림을 제공
- 인터넷 서비스와 애플리케이션은 TCP를 전송 메커니즘으로 사용, 기능별로 특정한 자신만의 프로토콜 가짐
- HTTP(Hypertext Transfer Protocol, 하이퍼텍스트 전송 프로토콜)
  - 웹 브라우저와 서버에 사용되는 간단한 프로토콜
  - 사용자가 링크를 클릭했을 때
    - 브라우저는 서버의 80번 포트에 대해 TCP/IP 연결을 열고 특정 페이지를 요청하는 짧은 메시지 보냄
    - 이때 브라우저는 클라이언트 애플리케이션
    - 메시지는 프로토콜 체인을 따라 내려가 인터넷을 가로질러 서버 애플리케이션까지 올라감

#### 텔넷과 SSH: 원격 로그인

- 텔넷(telnet): 다른 컴퓨터에 원격 로그인 세션을 설정하기 위한 TCP 서비스
- 일반적으로 23번 포트 사용, 다른 포트도 사용함
- ex. 아마존에 접근하는 방법
  - GET: HTTP 요청 중 하나
  - /: 서버에 기본 파일을 요청
  - HTTP/1.0: 프로토콜 이름과 버전

```
$ telnet www.amazom.com 80
GET / HTTP/1.0
    [여기서 Enter를 한 번 더 입력하라]
```

- 원격 컴퓨터에 직접 연결돼 있는 것처럼 접근할 수 있도록 함
- 클라이언트의 키 입력 받음 -> 서버에 직접 입력된 것처럼 서버로 키 입력 전달
- 서버의 출력을 가로채 클라이언트로 다시 보냄
- ex. 텔넷을 이용해 검색을 수행하는 방법

```
$ telnet www.google.com 80
GET /search?q=검색어
    [여기서 Enter를 한 번 더 입력하라]
```

- 텔넷은 보안 기능을 제공하지 않음
  - 원격 시스템이 비밀번호 없이 로그인 허용 -> 아무 정보도 요청받지 않고 로그인 가능
  - 원격 시스템에서 비밀번호 요구 -> 클라이언트에서 입력한 비밀번호를 변형 없이 전송 -> 누구든 비밀번호를 볼 수 있음
- SSH(Secure Shell, 시큐어 쉘): 양방향의 모든 트래픽을 암호화. 22번 포트 사용

#### SMTP: 단순 메일 전송 프로토콜

- SMTP(Simple Mail Transfer Protocol, 단순 메일 전송 프로토콜)
  - 메일 서비스에 2가지 기본 프로토콜이 필요
  - SMTP는 다른 시스템과 메일을 교환하는 데 사용
  - 수신자의 메일 처리용 컴퓨터에 있는 25번 포트로 TCP/IP 연결을 설정
  - 프로토콜 내용에 따라 발신자와 수신자를 식별하고 메시지를 전송
- 텍스트 기반. 25번 포트에 텔넷을 실행해 작동방식 확인 가능
- 메일 메시지가 아스키코드 텍스트일 것을 요구
  - MIME(Multipurpose Internet Mail Extensions, 다목적 인터넷 메일 확장)
    - 다른 종류의 데이터를 텍스트로 변환하는 방법과 여러 개의 조각을 단일 메일 메시지로 결합하는 방법을 기술한 표준
    - 사진이나 비디오 등 첨부 파일을 메일에 포함하는 데 사용
- 종단 간(end-to-end) 프로토콜
- 컴퓨터에서 로컬로 사용하기에도 곤란할 만큼의 보안 제약
  - TCP/IP 패킷은 출발지에서 목적지로 가는 도중 15~30개의 게이트웨이 통과
  - 경로상에 있는 게이트웨이는 얼마든지 패킷 조사 가능, 나중에 검사할 수 있도록 사본 만들 수 있음
  - SMTP 프로토콜 자체로 메일 내용 사본을 만들 수 있음. 메일 시스템은 메일 내용과 헤더 정보를 계속 파악
  - 메일 내용을 비공개로 유지하려면 출발지에서 암호화해야 함
- IMAP(Internet Message Access Protocol, 인터넷 메시지 접근 프로토콜)
  - 메일이 서버에 남아 있음 -> 수신자가 여러 곳에서 메일에 접근 가능
  - 메일을 동시에 여러 명이 읽거나 업데이트해도 우편함이 항상 일관된 상태를 유지하도록 함
  - 메시지 사본을 여러 개 만들거나 컴퓨터 간 복사해서 옮길 필요가 없음
- 메일은 흔히 클라우드에서 처리됨
  - 메일 전송을 위해 SMTP 사용, 클라이언트 접근에 대해서는 IMAP처럼 동작
 
#### 파일 공유와 P2P 프로토콜

- 냅스터(Napster): MP3 포맷으로 압축된 음악을 쉽게 공유하는 프로그램
  - 사용 방법
    - 컴퓨터에 냅스터 클라이언트 프로그램을 다운로드
    - 클라이언트는 공유할 파일을 담을 로컬 폴더 생성
    - 클라이언트가 냅스터 서버에 로그인 -> 클라이언트는 공유 파일의 이름을 업로드
    - 냅스터는 현재 이용 가능한 파일 이름을 담고 있는 중앙 디렉터리에 이름을 추가
    - 중앙 디렉터리는 지속적으로 업데이트
    - 새 클라이언트가 연결 -> 파일 이름 추가
    - 클라이언트가 서버의 조사에 응답 못함 -> 클라이언트가 업로드한 파일 이름이 목록에서 제거
  - 공유 과정
    - 사용자가 중앙 디렉터리에서 노래 제목이나 가수 검색 -> 현재 온라인 상태이면서 해당 파일을 공유할 용의가 있는 다른 사용자의 목록 제공
    - 사용자가 파일 공급자 선택 -> IP 주소와 포트 번호를 제공해 접촉 주선 -> 사용자 컴퓨터의 클라이언트 프로그램이 공급자와 직접 접촉해 파일 가져옴
  - 공급자와 사용자는 냅스터에 상태를 보고. 그 외에는 중앙 서버가 관여하지 않음
- 클라이언트-서버 모델: 브라우저(클라이언트)가 웹사이트(서버)에 요청
- P2P(peer-to-peer) 모델
  - 냅스터는 현재 공유할 수 있는 음악 목록을 관리하는 중앙 디렉터리를 제공. 음악 파일 자체는 사용자 컴퓨터에만 저장
  - 파일이 전송될 때, 중앙 시스템을 통하지 않고 한 냅스터 사용자에서 다른 냅스터 사용자로 직접 전송
  - 파일을 공유하는 사용자들이 peer에 해당
- 비트토렌트(BitTorrent): P2P 프로토콜 사용
  - 파일을 다운로드하는 각각의 사용자는 같은 파일을 다운로드하려는 다른 사람에게도 본인이 가진 파일 조각을 업로드해야 함
  - 분산된 디렉터리를 검색해 파일 찾음
  - 용량이 작은 토렌트 파일을 사용해 누가 어떤 블록을 보내고 받았는지 기록을 유지하는 트래커 식별
