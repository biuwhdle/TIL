## 1일 1로그 100일 완성 IT지식

3부 통신 - 067 데이터를 전송하는 핵심 프로토콜 TCP/IP

#### 프로토콜

- 프로토콜: 양측이 상호작용하는 방식에 대한 규칙을 정의
- IP(Internet Protocol, 인터넷 프로토콜): 개별 패킷의 형식을 지정하고 패킷을 전송하는 방법을 정의
- TCP(Transmission Control Protocol, 전송 제어 프로토콜): IP 패킷을 데이터 스트림으로 결합하고 서비스에 연결하는 방법을 정의
- 두 프로토콜을 합쳐 TCP/IP라고 함
- 프로토콜 계층
  - 게이트웨이는 IP 패킷을 라우팅, 각 물리적 네트워크에는 IP 패킷을 전달하기 위한 고유 형식 존재
  - 각 게이트웨이는 패킷이 들어오고 나갈 때 네트워크 형식과 IP 형식 간 변환을 수행해야 함
  - IP 레벨 위에서는 TCP가 안정적인 통신 제공 -> 사용자가 패킷에 관해 생각할 필요 없음
  - 애플리케이션 레벨 프로토콜: 주로 TCP 기반으로 구현. 웹, 메일, 파일 전송 등 서비스 제공
  - 각각은 바로 아래에 있는 프로토콜의 서비스에 의존, 바로 위에 있는 프로토콜에 서비스 제공
- UDP(User Datagram Protocol, 사용자 데이터그램 프로토콜): TCP와 같은 레벨
  - TCP보다 훨씬 단순, 양방향 스트림이 필요하지 않은 데이터 교환에 사용
  - 몇 가지 제한된 기능만 제공 -> 패킷을 효율적으로 전송할 용도
 
#### IP: 인터넷 프로토콜

- 신뢰성 없는(unreliable) 비연결형(connectionless) 패킷 전송 서비스 제공
- 비연결형: 각 IP 패킷이 자립적. 다른 IP 패킷과 관계가 없음
  - 상태를 관리하거나 기억하는 기능 없음
  - 어떤 패킷이 다음 게이트웨이로 전달되고 나면 그 패킷에 대해 기억할 필요 없음
- 신뢰성 없는: 패킷이 잘 전송되는 것을 보장하지 않는 최선형(best effort) 프로토콜
  - 패킷은 분실되거나 손상될 수 있음
  - 순서가 뒤바뀐 채 전달될 수 있음
  - 너무 일찍 도착해서 처리하기 어렵거나 너무 늦게 도착해서 쓸모가 없어질 수도 있음
  - IP는 패킷의 복구를 시도하지 않음
- IP 패킷의 최대 크기: 65KB
  - 긴 메시지는 작은 덩어리로 분할되어 개별 전송, 받는 쪽에서 재조합
  - IPv4 패킷 방식: 버전, 타입, 헤더 길이, 전체 길이, TTL, 출발지 주소, 목적지 주소, 오류 검사, 데이터
- TTL(Time To Live, 타임 투 리브): 패킷의 출발지에서 초깃값(보통 40)으로 설정, 패킷을 처리하는 각 게이트웨이를 거칠 때마다 1씩 감소되는 1바이트 필드
  - 카운트가 0 -> 패킷 폐기, 송신자에게 오류 패킷 보내짐
  - 순환 상태는 해결 x. 개별 패킷이 영원히 돌아다니는 문제 방지
- 데이터 전송 속도에 대해 보장하지 않음
  - 인터넷은 데이터 전송을 유지, 응답 속도를 높이기 위해 캐싱 사용
  - 콘텐츠 배포(content distribution) 서비스: 수신자에 더 가까운 위치에 콘텐츠를 캐싱함

#### TCP: 전송 제어 프로토콜

- 사용자에게 신뢰성 있는 양방향 스트림 제공
  - 데이터를 한쪽 끝에 넣으면 반대쪽 끝에서 나옴
  - 전송 지연이 적고 오류 발생 확률이 낮음
- 기본 아이디어
  - 바이트 스트림이 여러 조각으로 나뉘어 세그먼트(segment)라는 TCP 패킷에 담김
  - TCP 세그먼트에는 실제 데이터뿐 아니라 헤더(제어 정보를 포함) 들어있음
  - 제어 정보에는 수신자가 각 패킷이 스트림의 어느 부분을 나타내는지 알 수 있게 해주는 시퀀스 번호 포함
  - 세그먼트 분실 -> 어느 세그먼트인지 알아내서 재전송
  - 세그먼트에 오류 검출 정보 포함 -> 손상된 세그먼트 찾아낼 수 있음
  - 각 TCP 세그먼트는 IP 패킷에 실려서 전송
- TCP 세그먼트 헤더 형식: 출발지 포트, 목적지 포트, 시퀀스 번호, 확인 응답, 오류 검사, 기타 정보
- 수신자는 각 세그먼트에 대해 확인 응답 보내야 함
  - 긍정 응답(acknowledgment): 세그먼트를 받았음을 표시
    - 응답 x -> 해당 세그먼트가 분실됐다고 추정, 다시 보냄
  - 부정 응답: 일정 시간이 지나도 세그먼트 받지 못했음을 표시
- 응답이 효율적으로 작동하게 하는 메커니즘
  - 발신자는 이전 패킷에 대한 확인 응답을 기다리지 않고 패킷을 보낼 수 있음
  - 수신자는 여러 개의 패킷에 단일 확인 응답을 보낼 수 있음
  - 트래픽이 원활 -> 확인 응답으로 인한 오버헤드 줄어듦
  - 트래픽 정체, 패킷 분실 -> 발신자가 더 낮은 속도로 되돌렸다가 다시 천천히 속도를 올려야 함
- 포트(port)
  - 두 호스트 컴퓨터 간 TCP 연결 설정 -> 해당 컴퓨터의 특정 포트와도 연결
  - 각 포트는 서로 다른 대화 나타냄
  - 2바이트(16비트) 숫자로 표현 -> 포트는 최대 65536개
  - 100개의 잘 알려진 포트: 표준 서비스에 연결하는 용도로 예약되어 있음
