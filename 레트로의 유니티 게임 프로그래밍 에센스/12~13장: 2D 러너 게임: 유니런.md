## 레트로의 유니티 게임 프로그래밍 에센스

12장: 유니런: 배경 스크롤링과 게임 매니저 / 13장: 유니런: 발판 반복 생성과 게임 완성

#### 게임 배경 관련

- 정렬 레이어(Sorting Layer): Sprite Renderer 컴포넌트에 위치
  - 2D 게임 오브젝트가 그려지는 순서를 결정함
  - 가장 아래쪽 정렬 레이어가 가장 앞쪽에 그려짐
- 반복 스크롤링
  - 크랭키 박스(Crankie Box)와 비슷
  - 게임 오브젝트의 X축 위치가 -width가 되는 순간 +width로 변경 -> 배경 스크롤링이 무한 반복
  - width: 게임 오브젝트에 Box Collider 2D 컴포넌트를 추가해 구할 수 있음
    - Box Collider 2D: 추가될 때 2D 게임 오브젝트의 Sprite에 맞춰서 크기가 자동 설정
    - Box Collider 2D의 size 필드의 s값 = 게임 오브젝트의 가로 길이

#### Canvas

- 모든 UI 요소를 잡아주는 Root 게임 오브젝트
- Canvas의 크기나 가로세로 비율이 달라짐 -> Canvas에 배치된 UI의 모습도 다르게 보임
- Canvas의 크기: 화면의 해상도로 결정
  - Constant Pixel Size(고정 픽셀 크기): Canvas 컴포넌트의 UI Scale Mode의 기본 설정
    - Canvas 크기가 변해도 배치된 UI 요소의 크기를 변경하지 않음
    - UI의 크기와 배치가 사용자의 화면 크기에 따라 달라지는 문제 발생
  - Scale With Screen Size(화면 크기에 따라 스케일)
    - 기준 화면 크기를 정함. 실행 화면이 기준 화면보다 크거나 작을 때 자동으로 확대 및 축소
    - 화면 크기가 달라질 때, Canvas의 자체를 확대하거나 축소함
    - 실제 화면과 기준 해상도 사이의 화면 비율이 다를 때
      - Canvas Scaler 컴포넌트의 Match 필드 값이 높은 방향의 길이를 유지, 다른 방향의 길이를 조절
      - 일치 값이 높은 방향은 UI 레이아웃 유지. 다른 방향의 레이아웃은 망가질 수 있음
    - UI 요소가 많이 나열된 방향의 일치 값을 높게 주는 것이 좋음
       
#### GameManager

- GameManager의 조건
  - 단일 오브젝트: 일반적으로 프로그램에 단 하나만 존재해야 함
    - ex. 파일 매니저가 2개일 경우: 두 파일 매니저가 동시에 하나의 파일에 접근하고 수정 -> 오류 발생
  - 손쉬운 접근: 언제 어디서든 즉시 접근 가능해야 함
    - 프로그램의 특정 영역이 아니라 어느 곳에서도 사용할 수 있는 편의 기능 제공
    - 코드 어느 곳에서도 쉽게 접근해 사용할 수 있도록 구현
- 싱글턴 패턴: 어떤 오브젝트가 프로그램에 단 하나만 존재해야 하며, 어느 곳에서도 쉽게 접근 가능해야 할 때 사용
  - static(정적) 변수의 특징 활용
    - 해당 타입의 오브젝트의 수에 상관없이 메모리에 하나만 존재
    - 같은 타입의 모든 오브젝트가 해당 변수를 공유
    - class 외부에서의 접근: (class 이름).(해당 변수 이름)
- 게임 재시작: 현재 활성화된 scene을 다시 load하는 방식으로 구현 가능
  - using UnityEngine.SceneManagement; 선언 추가
  - SceneManager.GetActiveScene(): 현재 활성화된 씬의 정보를 Scene 타입의 오브젝트로 가져오는 메서드
  - Scene 타입의 오브젝트는 Scene의 이름을 변수 name으로 제공

#### Object Pooling

- 초기에 필요한 만큼 오브젝트를 미리 만들어 Pool에 쌓아두는 방식
- 새로운 오브젝트가 필요할 때: Pool에 있는 오브젝트를 가져다 씀
- 오브젝트가 필요 없을 때: 오브젝트를 비활성화하고 Pool에 반환
- 사용하는 이유: 오브젝트를 너무 자주 생성사거나 파괴하면 프리즈 현상 발생
  - 성능을 많이 요구하는 메서드
    - Instantiate(): 오브젝트를 실시간으로 생성
    - Destroy(): 오브젝트를 실시간으로 파괴
  - GC(가비지 컬렉션): 메모리 정리
- 로딩 시간이 길어질 수 있음 (게임 초반에 오브젝트를 미리 생성하기 때문)

#### 기타

- Awake(): 초기 1회 자동 실행. Start()보다 실행시점이 1프레임 빠름
- Vector2 값을 Vector3 변수에 할당 -> Vector2 값이 z값이 0인 Vector3 타입으로 자동 형변환
- this: 오브젝트가 자기 자신을 가리키는 키워드. 스스로에 대한 참조값 출력
- OnEnable(): 유니티 이벤트 메서드. 자동으로 1번 실행. 컴포넌트가 활성화될 때마다 다시 실행
  - 컴포넌트를 끄고 다시 켜는 방식으로 재실행 가능
  - 게임 오브젝트를 끄고 켜는 방식으로 재실행하는 것도 가능 (게임 오브젝트가 활성화/비활성화될 때 게임 오브젝트의 컴포넌트도 함께 활성화/비활성화)
  - 게임 오브젝트가 활성화될 때마다 상태를 리셋하는 기능을 구현할 때 주로 이용 (초기화 코드를 추가)
- Instantiate(원본, 생성 위치, 회전);
  - Quaternion.identity: 오일러각의 (0,0,0) 회전에 대응
- Time.time: 게임 시작 후 시간이 몇 초 지났는지 출력하는 변수
- Audio Source 컴포넌트의 Loop: Audio Clip을 반복 재생
